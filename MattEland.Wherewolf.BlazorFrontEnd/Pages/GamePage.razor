@page "/games/{GameId:guid}"

<PageTitle>Wherewolf</PageTitle>

<MudText Typo="Typo.h1" data-testid="PageHeader">
    Let's Play Wherewolf!
</MudText>
<MudText Typo="Typo.subtitle2" data-testid="PageSubtitle" Class="mb-8">
    Welcome to game <small>@GameId</small> of the <strong>Wherewolf</strong> 
    AI Simulation by <MudLink Href="https://MattEland.dev">Matt Eland</MudLink>
</MudText>

@if (Game is null)
{
    <MudAlert Severity="Severity.Error" Variant="Variant.Outlined">
        Game @GameId could not be found
    </MudAlert>
}
else
{
    <MudPaper class="pa-8 ma-2" Elevation="3">
        <MudText Typo="Typo.h2">Game Board</MudText>
        
        <MudText Typo="Typo.h4" Class="my-4">Center Slots</MudText>
        <MudGrid>
            @foreach (var slot in Game.CenterSlots)
            {
                <MudItem>
                    @slot.Name
                </MudItem>
            }
        </MudGrid>
        
        <MudDivider Class="my-8" />
        
        <MudText Typo="Typo.h4" Class="my-4">Players</MudText>
        <MudGrid>
            @foreach (var slot in Game.PlayerSlots)
            {
                <MudItem>
                    @slot.Name
                </MudItem>
            }
        </MudGrid>
    </MudPaper>
    
    <MudPaper class="pa-8 ma-2" Elevation="3">
        <MudText Typo="Typo.h2">Events</MudText>
        
        <MudTimeline TimelineOrientation="TimelineOrientation.Vertical" 
                     TimelinePosition="TimelinePosition.Left">
            @foreach (var evt in VisibleEvents)
            {
                <MudTimelineItem Color="@CalculateEventColor(evt)" TimelineAlign="TimelineAlign.End">
                    <ItemContent>
                        <MudText Typo="Typo.h6" Color="@CalculateEventColor(evt)">
                            @evt.Description
                        </MudText>
                    </ItemContent>
                    <ItemOpposite>
                        <MudText Typo="Typo.h6">@evt.GetType().Name</MudText>
                    </ItemOpposite>
                </MudTimelineItem>
            }
        </MudTimeline>
    </MudPaper>
    
    @if (IsGameOver)
    {
        <MudAlert Severity="Severity.Info" Variant="Variant.Filled" Class="mt-8">
            The game has ended.
        </MudAlert>
    }
    else
    {
        <MudButtonGroup Class="my-8" Color="Color.Primary" Size="Size.Large" Variant="Variant.Filled">
            <MudButton OnClick="AdvanceToNextPhase"
                       Disabled="!CanAdvance">
                Next
            </MudButton>
            <MudButton OnClick="AdvanceToVoting"
                       Disabled="!CanAdvance">
                Run to Voting
            </MudButton>            
            <MudButton OnClick="AdvanceToEnd"
                       Disabled="!CanAdvance">
                Run to End
            </MudButton>
        </MudButtonGroup>
    }
}